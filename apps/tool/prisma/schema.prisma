// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       Int    @id @default(autoincrement())
  name     String
  email    String @unique
  surname  String
  password String

  @@map("users")
}

model Setting {
  id    Int    @id @default(autoincrement())
  name  String @unique
  value String

  @@map("setting")
}

model Language {
  id       Int        @id @default(autoincrement())
  name     String     @unique
  code     String     @unique @db.VarChar(2)
  roles    Role[]
  Template Template[]
  Category Category[]

  @@map("languages")
}

model Role {
  id                 Int               @id @default(autoincrement())
  name               String
  model              String            @default("gpt-3.5-turbo")
  topP               Float             @default(1)
  system             RoleSystemPrompt?
  language           Language          @relation(fields: [language_id], references: [id], onDelete: Cascade)
  temperature        Float             @default(1)
  presentPenalty     Float             @default(0)
  frequencyPenalty   Float             @default(0)
  language_id        Int

  @@index([name])
  @@map("roles")
}

model RoleSystemPrompt {
  id      Int    @id @default(autoincrement())
  role    Role   @relation(fields: [role_id], references: [id], onDelete: Cascade)
  role_id Int    @unique
  content String

  @@map("role_systems_promps")
}

model Template {
  id               Int              @id @default(autoincrement())
  name             String
  context          ContextMessage[]
  category         Category?        @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  categoryId       Int?
  language         Language         @relation(fields: [language_id], references: [id], onDelete: Cascade)
  language_id      Int
  model            String           @default("gpt-3.5-turbo")
  topP             Float            @default(1)
  temperature      Float            @default(1)
  presentPenalty   Float            @default(0)
  frequencyPenalty Float            @default(0)

  @@index([name])
  @@map("tamplates")
}

model ContextMessage {
  id          Int      @id @default(autoincrement())
  role        String
  content     String
  position    Int
  template    Template @relation(fields: [template_id], references: [id], onDelete: Cascade)
  template_id Int

  @@unique([position, template_id])
  @@map("context_messages")
}

model Category {
  id          Int        @id @default(autoincrement())
  name        String     @unique
  language    Language   @relation(fields: [language_id], references: [id], onDelete: Cascade)
  language_id Int
  templates   Template[]

  @@map("categories")
}
